<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Weather Info Page</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,900" rel="stylesheet">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="./bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./stylesheets/bootstrap.min.css">

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 1.0em;
            color: #fff;
            text-shadow: .1em .1em 0 rgba(0, 0, 0, 0.3);
            background-image: linear-gradient(to right top, #99bbcb, #a5c7d7, #b1d4e2, #bde0ee, #c9edfa);
        }

        h1 {
            margin: 0 auto;
            font-size: 2.2em;
            text-align: center;
            color: #fff;
            font-size: 3em;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="./stylesheets/mystyle.css">
</head>

<body>
    <div class="headerCss">

        <div class="row">
            <div class="col">
                <h1 STYLE="text-align: center;">Analysis Detail Page</h1>
            </div>
        </div>
        <div class="row">
            <div class="col" STYLE="text-align: left;">
                <label> This page show the analysis of 50 cities' 5-days-weather condition.</label>
            </div>
        </div>

    </div>
    <br><br><br>

    <div class="container">
        <div class="row">
            <div class="col">
                <div id="aveScore_chart"></div>
            </div>
            <!-- <div class="col-sm-4">
                <div id="sd_chart"></div>
            </div>
            <div class="col-sm-4">
                <div id="scoreChange_chart"></div>
            </div> -->
        </div>
        <br><br>
        <div class="row">
            <div class="col">
                <div id="sd_chart"></div>
            </div>
        </div>
        <br><br>
        <div class="row">
            <div class="col">
                <div id="scoreChange_chart"></div>
            </div>
        </div>
    </div>
    <br><br>

    <div class="container">
        <div class="row">
            <label>Analysis detail</label>
        </div>
        <div class="row">
            <label id="details"></label>
        </div>
    </div>
    <br><br>

    <div class="container">
        <button id="home">Back to homepage</button>
    </div>


    <script lang="text/javascript">
        var scores = new Array();
        var stds = new Array();
        var cities = new Array();
        window.onload = function () {
            obtainScore();

        }

        document.getElementById("home").onclick = function () {
            window.location.href = "/";
        }

        function obtainScore() {
            var index = 0;
            let xhr = new XMLHttpRequest();
            xhr.open("GET", `http://cc2-weather-analysis.us-east-1.elasticbeanstalk.com/forecastscore`, true);//read cache from endpoint to get analyzed score.
            xhr.send();
            xhr.onload = function () {
                data = JSON.parse(xhr.responseText);
                // console.log(data);
                data.forEach(element => {
                    for (var key in element) {
                        var city, score, std;
                        if (element.hasOwnProperty(key)) {
                            console.log(key + " -> " + element[key]);
                            if (key == "city") {
                                city = element[key];
                            } else if (key == "score") {
                                score = element[key];
                            } else if (key == "std") {
                                std = element[key];
                            }
                        }
                    }
                    cities[index] = city;
                    scores[index] = score;
                    stds[index] = std;
                    console.log(city);
                    console.log(score);
                    console.log(std);
                    index++;
                });
                google.charts.load('current', { 'packages': ['corechart'] });
                google.charts.setOnLoadCallback(drawAveScoreChart);
                google.charts.setOnLoadCallback(drawStdChart);
                google.charts.setOnLoadCallback(drawScoreChangeChart);
                document.getElementById('details').innerHTML='The charts above generated by the formula we created for weather condition .'+
                ' The greater average score a city has, if the standard deviation is small, then the better weather the city will have.'+
                ' On the contrary, if a city has a small average score, or if a city has a high standard deviation with a large average score,'+
                ' it means the city will have a bad weather condition in the future 5 days.';
            }
        }

        function drawAveScoreChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'cities');
            data.addColumn('number', 'scores');
            for (i = 0; i < cities.length; i++)
                data.addRow([cities[i], scores[i]]);


            var options = {
                title: 'The average score for each city in five days',
                curveType: 'function',
                legend: { position: 'bottom' }
            };

            var chart = new google.visualization.ColumnChart(document.getElementById('aveScore_chart'));

            chart.draw(data, options);
        }

        function drawStdChart() {

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'cities');
            data.addColumn('number', 'standard deviation');
            for (i = 0; i < cities.length; i++)
                data.addRow([cities[i], stds[i]]);

            var options = {
                title: 'The standard deviation of scores for each city in five days',
                legend: { position: 'bottom' },
                bar: { groupWidth: '50%' }, // Remove space between bars.
            };

            var chart = new google.visualization.LineChart(document.getElementById('sd_chart'));
            chart.draw(data, options);
        }

        function drawScoreChangeChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'cities');
            data.addColumn('number', 'score');
            data.addColumn('number', 'score');
            data.addColumn('number', 'score');
            data.addColumn('number', 'score');

            for (i = 0; i < cities.length; i++)
                data.addRow([cities[i], scores[i] - stds[i], scores[i], scores[i], scores[i] + stds[i]]);


            // Col 0: String used as a label for this marker on the X axis.
            // Col 1: Number specifying the low/minimum value of this marker. This is the base of the black line.
            // Col 2: Number specifying the opening/initial value of this marker. This is one vertical border of the candle. If less than the column 3 value, the candle will be green; otherwise it will be red.
            // Col 3: Number specifying the closing/final value of this marker. This is the second vertical border of the candle. If less than the column 2 value, the candle will be red; otherwise it will be green.
            // Col 4: Number specifying the high/maximum value of this marker. This is the top of the black line.
            // 2 is same as 1 and 3 is same as 4 in this case

            var options = {
                title: 'The change of scores for each city in five days',
                legend: { position: 'bottom' },
                bar: { groupWidth: '50%' }, // Remove space between bars.
            };

            var chart = new google.visualization.CandlestickChart(document.getElementById('scoreChange_chart'));
            chart.draw(data, options);
        }

    </script>


</body>

</html>